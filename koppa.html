<!DOCTYPE html>
<html>
  <head>
    <title>The Koppa Adventures</title>
    <link rel="icon" type="image/png" href="./resources/photos/PacerCrop.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="manifest" href="../site.webmanifest">
    <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
  	<link rel="stylesheet" type="text/css" href="./resources/css/collapsible.css"/>
    <link rel="stylesheet" type="text/css" href="./resources/css/styleSP.css"/>
    <link rel="stylesheet" type="text/css" href="./resources/css/headerSP.css"/>
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Hammersmith+One' rel="stylesheet"/>
	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	crossorigin=""/>
	<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	crossorigin=""></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<style>
		#mapid { height: 50vh; width:50vw; z-index: 0; }
	</style>
  </head>
  <header>
      <h1>
	<div id="nav-placeholder">
	      </div>
      </h1>
  </header>
	
<script>
$(function(){
  $("#nav-placeholder").load("nav.html");
  $("#Koppa1").load("koppa/koppa1.html");
  $("#Koppa2").load("koppa/koppa2.html");
  $("#Koppa3").load("koppa/koppa3.html");
  $("#Koppa4").load("koppa/koppa4.html");
  $("#Koppa5").load("koppa/koppa5.html");
  $("#Koppa6").load("koppa/koppa6.html");
  $("#Koppa7").load("koppa/koppa7.html");
  $("#Koppa8").load("koppa/koppa8.html");
  $("#Koppa9").load("koppa/koppa9.html");
  $("#Koppa10").load("koppa/koppa10.html");
  $("#Koppa11").load("koppa/koppa11.html");
});
</script>
	
  <body>
    <h1 class= "spacing"> Koppa </h1>
	  <div class="intro">
<p>       Koppa Adventures: coming soon to a tube platform near you! As mentioned on <a href="./index.html"> our 
	  main page </a>, the Koppa (&#x3D9;) adventures on the tube/TfL network will follow different rules to usual. We have 
	  only recently started university, so we will be unable to undertake these frequently, but this has been planned for many 
	  months. London is uniquely suited to NT adventures due to the frequency of services and density of stations, so our 
	  adventures here should be optime!
	  <br><br>
	  So, James has gone to absolute pits and now is a big twitter enthusiast, he has created a twitter with associated twitter 
	  bot, this was what he was doing all the way up to London. Find it <a href="https://twitter.com/NuttyTrains">here</a>...
</p>
		<center><div id="mapid">Testy Test</div></center>
		<div style="padding: 1em 1em 1em 1em;">
</div>


<button type="button" class="collapsible">&#x3D9;1: "I think I'm turning into a Londoner!"</button>
<div id="Koppa1" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;2: "You miserable excuse for a railway!"</button>
<div id="Koppa2" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;3: "I want a CHICKEN. AND. BACON!"</button>
<div id="Koppa3" class="content">
</div>	 


<button type="button" class="collapsible">&#x3D9;4: "This one's for the foot fetishists!"</button>
<div id="Koppa4" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;5: ♫ Always look on the shit side of life! ♫ </button>
<div id="Koppa5" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;6: "I don't do communisms... unless I am desperate" </button>
<div id="Koppa6" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;7: "I like trains - it's an autism thing" </button>
<div id="Koppa7" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;8: "This reminds me of when I met my wife - I met her in a petrol station" </button>
<div id="Koppa8" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;9: "Let's go and make fun of the French" </button>
<div id="Koppa9" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;X: The crackheads of Sudbury Town </button>
<div id="Koppa10" class="content">
</div>


<button type="button" class="collapsible">&#x3D9;11: "They didn't even give us the kids menu" </button>
<div id="Koppa11" class="content">
</div>


<br><br>	  
	<center>
		  <img src="https://i.imgur.com/NKg0yQE.gif" width="40%">
		  <img src="./resources/photos/Koppa 10 Map.png" width="58%">
		  <br><br>
		  <img src="./resources/photos/Koppa Orphan Map.png" width="40%">
	</center>
</div>
</body>

<script>
	var coll = document.getElementsByClassName("collapsible");
var i;
for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.maxHeight){
      content.style.maxHeight = null;
    } else {
      content.style.maxHeight = content.scrollHeight + "px";
    } 
  });
}

function uniq(a) {
    return a.sort().filter(function(item, pos, ary) {
        return !pos || item != ary[pos - 1] || item != null;
    });
}

var mymap = L.map('mapid').setView([51.555, -0.1778], 9);
L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'This is the NT Station Visit Map, we`ve been to all of the dots!',
    maxZoom: 15,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoibnV0dHl0cmFpbnMiLCJhIjoiY2tuNGx3YTlhMXFlcDJ2cGNyYnJvdjc3MiJ9.muQLAtpQ9ovpOrC8xc1hOw'
}).addTo(mymap);

d3.text("./data/tubeStations.csv", function(data) {
    var parsedCSV = d3.csv.parseRows(data);
    // console.log(parsedCSV)
    // console.log(parsedCSV.length)
    d3.text("./data/tube.csv", function(data2) {
        var tubeVisited = d3.csv.parseRows(data2);
		d3.text("./data/dlr.csv", function(data3) {
			var dlrVisited = d3.csv.parseRows(data3);
			d3.text("./data/orange.csv", function(data4) {
				var orangeVisited = d3.csv.parseRows(data4);
				d3.text("./data/purp.csv", function(data5) {
					var purpVisited = d3.csv.parseRows(data5);
					d3.text("./data/tram.csv", function(data6) {
						var tramVisited = d3.csv.parseRows(data6);
						var Visited = tubeVisited.concat(dlrVisited, orangeVisited, purpVisited, tramVisited)
						const arrayColumn = (arr, n) => arr.map(x => x[n]);
						for (i = 1; i < parsedCSV.length; i++) {
							console.log(i);
							console.log(parsedCSV[i][2]);
							console.log(arrayColumn(Visited, 0).includes(parsedCSV[i][2]));
							N = arrayColumn(Visited, 0).indexOf(parsedCSV[i][2]);
							console.log(N);
							// console.log(arrayColumn(Visited, 0));
							if (arrayColumn(Visited, 0).includes(parsedCSV[i][2])) {
								L.marker([parsedCSV[i][9], parsedCSV[i][8]], {
									title: Visited[N][1],
									name: Visited[N][0],
									number: Visited[N][2],
									date: Visited[N][3],
									line: Visited[N][4],
									edition: Visited[N][5]
								}).on('click', onMapClick).addTo(mymap);
								// console.log('Added marker ' + i + ' at ' + parsedCSV[i][8] + ', ' + parsedCSV[i][9]);
								var popup = L.popup();
								function onMapClick(e) {
									popup
										.setLatLng(e.latlng)
										.setContent(
											'We visited ' + this.options.name + ', on the ' + this.options.line.split('//').join(', ') + 
											' line(s) during ' + _.uniq(this.options.edition.split('//')).join(' and ') + ' (' + this.options.date + '). '
											)
										// Nota Optime! This is going to backfire horribly once we have the separate CSVs for each mode - you will need to come back and fix this!
										.openOn(mymap);
								}
							}
						}
						console.log(Visited);
					});
				});
			});
		});
    });
});         
</script>
</html>
