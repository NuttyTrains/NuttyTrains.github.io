<!DOCTYPE html>
<html>
  <head>
    <title>NT Santa Tracker</title>
    <link rel="icon" type="image/png" href="./resources/photos/PacerCrop.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="manifest" href="../site.webmanifest">
    <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" type="text/css" href="./resources/css/santaSP.css"/>
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Hammersmith+One' rel="stylesheet"/>
	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.css' rel='stylesheet' />
	<script src="https://d3js.org/d3.v3.min.js"></script>
  </head>
	
  <body>
	<center><p id="iter">This Christmas, join Nutty Trains as we track Father Christmas on his journey around the world!</p>
	<div id="santamap">Merry Christmas!</div>
	<br><br>
	<div id="aud"></div></center>
	<br>
	<a href="index.html"><center><img align="right" src="./resources/photos/NT Logo 6.png" width="5%"></a>
</body>

<script>
const year = new Date().getFullYear();

mapboxgl.accessToken = 'pk.eyJ1IjoibnV0dHl0cmFpbnMiLCJhIjoiY2tuNGx3YTlhMXFlcDJ2cGNyYnJvdjc3MiJ9.muQLAtpQ9ovpOrC8xc1hOw';
	
const map = new mapboxgl.Map({
  container: 'santamap',
  style: 'mapbox://styles/mapbox/satellite-streets-v11',
  center: [20, 30],
  zoom: 1.5
});

map.addControl(new mapboxgl.FullscreenControl());
map.addControl(new mapboxgl.NavigationControl());

const y = []
const coords = []
const msg = []

d3.text("./data/santa.csv", function(data) {
    var parsedCSV = d3.csv.parseRows(data);
  	var now = new Date().getTime();
	const ell = document.createElement('div');
	ell.className = 'SantaTest2';

	setInterval(function(){
		q = new Date(`Dec ${parsedCSV[1][3]}, ${year} ${parsedCSV[1][4]}:${parsedCSV[1][5]}:00`).getTime();
		var now2 = new Date().getTime();
		var diff = Math.floor((q - now2)/1000);
		if (diff > 2073600) {
			document.getElementById("iter").innerHTML = `What are you doing here? Come back in December ${year}!`;
		}
		else if (diff > 12600) {
			document.getElementById("iter").innerHTML = `This Christmas, join Nutty Trains as we track Father Christmas on his journey around the world!`;
		}
		else if (diff > 10800) {
			document.getElementById("iter").innerHTML = `Wake up Father Christmas! It is Christmas Eve!`;
		}
		else if (diff > 9900) {
			document.getElementById("iter").innerHTML = `Father Christmas is getting dressed!`;
		}
		else if (diff > 9000) {
			document.getElementById("iter").innerHTML = `Father Christmas is having breakfast!`;
		}
		else if (diff > 8100) {
			document.getElementById("iter").innerHTML = `Father Christmas is feeding the reindeer!`;
		}
		else if (diff > 7200) {
			document.getElementById("iter").innerHTML = `Father Christmas is checking his naughty and nice list one last time!`;
		}
		else if (diff > 5400) {
			document.getElementById("iter").innerHTML = `The elves are programming Father Christmas' sleigh!`;
		}
		else if (diff > 3600) {
			document.getElementById("iter").innerHTML = `The final gifts are being loaded into the sleigh!`;
		}
		else if (diff > 3000) {
			document.getElementById("iter").innerHTML = `The reindeer are leaving their stable!`;
		}
		else if (diff > 2400) {
			document.getElementById("iter").innerHTML = `Rudolph is lighting up his nose!`;
		}
		else if (diff > 1800) {
			document.getElementById("iter").innerHTML = `The elves are doing the final checks on the sleigh!`;
		}
		else if (diff > 1200) {
			document.getElementById("iter").innerHTML = `Father Christmas is boarding the sleigh!`;
		}
		else if (diff > 600) {
			document.getElementById("iter").innerHTML = `The reindeer are lining up, ready to take off!`;
		}
		else if (diff > 0) {
			document.getElementById("iter").innerHTML = `Father Christmas is about to leave! Taking off in ${diff}...`;
		}
	}, 1000);

	for (i = 1; i < parsedCSV.length; i++) {
	// add markers to map
	// create a HTML element for each feature
	const el = document.createElement('div');
	if (parsedCSV[i][0] == "Penryn" || parsedCSV[i][0] == "Carmarthen" || parsedCSV[i][0] == "DELETED" || parsedCSV[i][0] == "Dangleway" || parsedCSV[i][0] == "Camden" || parsedCSV[i][0] == "Harrow-on-the-Hill" || parsedCSV[i][0] == "Wuhan") {
		el.className = 'SantaTest4';
		el.title = `Fuck you, ${parsedCSV[i][0]}! ${parsedCSV[i][6]}`;
		msg.push(`Santa visited ${parsedCSV[i][0]} at ${parsedCSV[i][4]}:${parsedCSV[i][5]}. Fuck you, ${parsedCSV[i][0]}!`);
	}
	else {
		el.className = 'SantaTest';
		el.title = `Merry Christmas, ${parsedCSV[i][0]}! ${parsedCSV[i][6]}`;
		msg.push(`Santa visited ${parsedCSV[i][0]} at ${parsedCSV[i][4]}:${parsedCSV[i][5]}. Merry Christmas, ${parsedCSV[i][0]}!`);
	}
	coords.push(parsedCSV[i][2], parsedCSV[i][1]);
	//console.log(`Santa visited ${parsedCSV[i][0]} at ${parsedCSV[i][4]}:${parsedCSV[i][5]}. Merry Christmas, ${parsedCSV[i][0]}!`);
	y.push(new Date(`Dec ${parsedCSV[i][3]}, ${year} ${parsedCSV[i][4]}:${parsedCSV[i][5]}:00`).getTime());
		
		
	setTimeout(function(i){
	
	console.log(Number(y[i-1]-now-28508100));
	console.log(parsedCSV[i][0]);
	}, Number(y[i-1]-now-28508100), i);
}

});  
</script>
</html>
