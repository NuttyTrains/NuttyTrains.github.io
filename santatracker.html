<!DOCTYPE html>
<html>
  <head>
    <title>NT Santa Tracker</title>
    <link rel="icon" type="image/png" href="./resources/photos/PacerCrop.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="manifest" href="../site.webmanifest">
    <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
  	<link rel="stylesheet" type="text/css" href="./resources/css/collapsible.css"/>
    <link rel="stylesheet" type="text/css" href="./resources/css/styleSP.css"/>
    <link rel="stylesheet" type="text/css" href="./resources/css/headerSP.css"/>
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Hammersmith+One' rel="stylesheet"/>
	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
    	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.js'></script>
    	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.css' rel='stylesheet' />
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<style>
		#map { height: 70vh; width:70vw; z-index: 0; }
		
		.SantaTest {
		background-image: url('./resources/photos/present.gif');
		background-size: cover;
		width: 50px;
		height: 50px;
		cursor: pointer;
		}
		
		.mapboxgl-popup {
  			max-width: 200px;
		}

		.mapboxgl-popup-content {
  			text-align: center;
  			font-family: 'Raleway';
		}
	</style>
  </head>
  <header>
      <h1>
	<div id="nav2-placeholder">
	      </div>
      </h1>
  </header>
	
<script>
$(function(){
  $("#nav2-placeholder").load("nav2.html");
});
</script>
	
  <body>
    <h1 class= "spacing"> Santa Tracker </h1>
	  <div class="intro">
	<p>
		Testy test, I love testing shit
	</p>
	<center><div id="map">Testy Test</div></center>
	<div style="padding: 1em 1em 1em 1em;"></div>

</div>
</body>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibnV0dHl0cmFpbnMiLCJhIjoiY2tuNGx3YTlhMXFlcDJ2cGNyYnJvdjc3MiJ9.muQLAtpQ9ovpOrC8xc1hOw';
	
const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v11',
  center: [-0.1686, 51.5103],
  zoom: 12
});

d3.text("./data/santa.csv", function(data) {
    var parsedCSV = d3.csv.parseRows(data);
	//for (i = 1; i < parsedCSV.length; i++) {
	for (i = 1; i < 2; i++) {
		console.log(i);
	// add markers to map
	// create a HTML element for each feature
	const el = document.createElement('div');
	el.className = 'SantaTest';
	el.title = `Merry Christmas ${parsedCSV[i][0]}!`;
	el.name = parsedCSV[i][0];
	el.time = parsedCSV[i][3];
	//`Nov 28, 2021 ${parsedCSV[i][3]}:${parsedCSV[i][4]}:00`
  	var now = new Date().getTime();
  	var y = new Date(`Nov 28, 2021 19:22:00`).getTime();
		
setTimeout(function(){  
	// make a marker for each feature and add it to the map
	new mapboxgl.Marker(el)
		.setLngLat([parsedCSV[1][2], parsedCSV[1][1]])
		.setPopup(
			new mapboxgl.Popup({ offset: 25 }) // add popups
			.setHTML(`<p>'Santa visited ${parsedCSV[1][0]}, at ${parsedCSV[1][3]}:${parsedCSV[1][4]}. Merry Christmas, ${parsedCSV[1][0]}!'</p>`)
		)
		.addTo(map);
}, y-now);
}
});    
</script>
</html>
